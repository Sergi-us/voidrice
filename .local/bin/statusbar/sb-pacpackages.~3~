#!/bin/sh
# SARBS 07.07.2024
# Zeigt die Anzahl der aktualisierbaren Pakete f√ºr Pacman und YAY an.
# Damit dies funktioniert, sollte der Befehl `pacman -Sy` regelm√§√üig im
# Hintergrund als Cronjob vom Root-User ausgef√ºhrt werden.
# Dieses Skript liest dann diese Pakete.
# Bei einem Klick wird ein Upgrade √ºber Pacman durchgef√ºhrt.
#
# F√ºge den folgenden Text als Datei in /usr/share/libalpm/hooks/statusbar.hook hinzu:
#
# [Trigger]
# Operation = Upgrade
# Type = Package
# Target = *
#
# [Action]
# Description = Statusleiste aktualisieren...
# When = PostTransaction
# Exec = /usr/bin/pkill -RTMIN+8 dwmblocks # Oder i3blocks, wenn i3 verwendet wird.


## Check Pacman packages
# pacman_updates=$(pacman -Qu | grep -Fcv "[ignored]")
## Set default display value
# pacman_display="Ôíû0"
#if [ "$pacman_updates" -ne 0 ]; then
#  pacman_display=$(echo "$pacman_updates" | sed "s/^/Ôíû/")
#fi

# Check YAY packages
yay_updates=$(yay -Qu | grep -Fcv "[ignored]")
# Set default display value
yay_display="Ôç∞"
if [ "$yay_updates" -ne 0 ]; then
  yay_display=$(echo "$yay_updates" | sed "s/^/Ôç∞/")
fi

## Kombinierte Anzeigen von AUR und Pacman Packeten
#if [ -n "$pacman_display" ] && [ -n "$yay_display" ]; then
#  echo "$pacman_display $yay_display"
#elif [ -n "$pacman_display" ]; then
#  echo "$pacman_display"
#elif [ -n "$yay_display" ]; then
#  echo "$yay_display"
#else
#  echo "Ôíû0 Ôë®0"  # Display default values if no updates
#fi

# Display YAY updates only
echo "$yay_display"

case $BLOCK_BUTTON in
  1) setsid -f "$TERMINAL" -e sb-popupgrade ;;  # Linksklick: √ñffne ein Terminal und f√ºhre das Skript 'sb-popupgrade' aus
  2) notify-send "$(/usr/bin/pacman -Qu)" ;;    # Mittelklick: Zeige eine Benachrichtigung mit der Ausgabe von 'pacman -Qu'
  3) notify-send "üéÅ Upgrade module" "Ôç∞ : anzahl von Updatef√§higen Packeten
- Ô£ålinks um Packete zu aktualisieren
- Ô£åmittel um Aktualierbare Packete anzuzeigen" ;;  # Rechtsklick: Zeige eine Benachrichtigung mit einer Erkl√§rung der Klickaktionen
  6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;; # Sechster Maustasten-Klick: √ñffne das Skript im Editor
esac
